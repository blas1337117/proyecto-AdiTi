define(["$","sb/ooze","jquery-ui","lib/jquery-wait"],function(t,o){"use strict";var a=function(o){o.preventDefault();var a=t(this),e=t("<div/>",{"class":"tooltip-menu","data-tooltip-name":a.attr("data-tooltip-menu")}),i=t("<ul/>").appendTo(e),n=t("<div/>",{"class":"tooltip-menu-overlay"}),l=a.attr("data-tooltip-menu-active-class"),p=a.attr("data-tooltip-menu-target")?a.find(a.attr("data-tooltip-menu-target")):a,r=t.parseJSON(a.attr("data-tooltip-menu-items")),d=a.attr("data-tooltip-content");if(d){var s=t('[data-tooltip-container="'+d+'"]'),u=t('<div data-tooltip-placeholder="'+d+'"/>');s.after(u).appendTo(e.empty())}t.each(r,function(o,a){if(!a.text)return!0;var e=a.text;delete a.text,a["class"]=t.trim("tooltip-menu-item-link "+(a["class"]||"")),a.href||a["data-modal-href"]||(a["data-tooltip-menu-close"]="",a.href="javascript:void(0)"),i.append(t("<li/>",{"class":"tooltip-menu-item"}).append(t("<a/>",a).html(e)))}),l&&a.addClass(l),e.appendTo("body");var c=p.offset().top+p.outerHeight()+e.outerHeight()+22>t(window).height(),m=p.offset().left<200,f={left:p.offset().left-30-(m?0:e.outerWidth()-60)+p.outerWidth()/2},h={opacity:1};return e.toggleClass("tooltip-menu-l-left",m),c?(f.bottom=t(window).height()-p.offset().top,h["margin-bottom"]=11,e.addClass("tooltip-menu-l-bottom")):(f.top=p.offset().top+p.outerHeight(),h["margin-top"]=22),e.css(f).animate(h,200),n.appendTo("body").fadeIn().click(function(){n.fadeOut(200,function(){t(this).remove(),l&&a.removeClass(l)}),t(".tooltip-menu").animate({"margin-top":10,opacity:0},200,function(){var o=t(this).find("[data-tooltip-container]");if(o.length){var a=o.attr("data-tooltip-container"),e=t('[data-tooltip-placeholder="'+a+'"]');e.replaceWith(o),o.find(":input").first().trigger("change")}t(this).remove()})}),!1};t(function(){t("body").on("click.sbTooltipMenu","[data-tooltip-menu]",a).on("click.sbTooltipMenu","[data-tooltip-menu-close]",function(){t(".tooltip-menu-overlay").first().click();var a=t(this).parents("[data-tooltip-name]").attr("data-tooltip-name"),e=t('[data-tooltip-menu="'+a+'"]');o.drip(["tooltip","close",a],e,t(this))}).on("click.sbTooltipMenu",'.tooltip-menu-item a[target="_blank"], .tooltip-menu-item a[data-modal-href]',function(){t.wait(500).then(function(){t(".tooltip-menu-overlay").first().click()})})})});