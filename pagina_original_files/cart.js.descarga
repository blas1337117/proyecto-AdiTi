define(["$","sb/ooze","lib/postmessage","routes/cart"],function(t,e,n,r){"use strict";var a={};return a.add=function(){var e="object"==typeof arguments[0],n=e?arguments[0].id:arguments[0],o=e?arguments[0].type:arguments[1],s=e?arguments[0].details:arguments[2],u=e?arguments[1]:arguments[3],d=e?arguments[0].currency:arguments[4],c=e?arguments[0].sku:arguments[5];return t.ajax({type:"POST",data:{id:n,currency:d,sku:c,type:o,details:s},url:r("product_add"),success:function(t){t.success?(a.updateCount({itemCount:t.count}),a.open(),u&&u(t)):(alert(t.error),"undefined"==typeof t.count||t.count>0?a.open():a.close())}}),a},a.free=function(){var t="object"==typeof arguments[0],n=t?arguments[0].id:arguments[0],o=t?arguments[0].type:arguments[1],s=t?arguments[0].details:arguments[2],u=t?arguments[1]:arguments[3];return u&&e.on("modals.open.free-download",u),require(["sb/modals"],function(t){t.open("free-download",r("download_free",{id:n,type:o,details:s}),void 0,"none")}),a},a.open=function(){return t('<div class="cart-modal-loading"><span class="icon icon-spinner icon-t-animation-spin"/></div>').appendTo("body"),e.drip("cart.loading"),t("#sbcart").css("visibility","hidden").addClass("cart-frame-s-open").removeAttr("src").one("load",function(){t(this).css("visibility","visible"),t(".cart-modal-loading").remove(),e.drip("cart.open")}).attr("src",function(){return t(this).attr("data-src")}),e.drip("modals.do.close"),a},a.close=function(n){return t("#sbcart").removeAttr("src").removeClass("cart-frame-s-open"),e.drip("cart.close",n),a},a.updateCount=function(t){return e.drip("cart.updateCount",t),a},n.bind("cart.close",a.close),n.bind("cart.updateCount",a.updateCount),t("body").on("click","[data-cart-add]",function(){return a.add(t(this).data("cart-add")),!1}).on("click","[data-cart-free]",function(){return a.free(t(this).data("cart-free")),!1}),e.on("cart.do.open",a.open),a});