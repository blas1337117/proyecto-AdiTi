define('$',["jquery"],function(e){"use strict";function r(e){require(["sb/notice"],function(r){var t=r.error;401===e.status?t(e.responseJSON&&e.responseJSON.error||"You are not authorized to do this!"):400===e.status?t(e.responseJSON&&e.responseJSON.error||"An error occurred processing your request."):404===e.status?t(e.responseJSON&&e.responseJSON.error||"Resource could not be found."):0===e.status?"abort"!==e.statusText&&t("Could not complete request&mdash;are you connected to the Internet?"):t("An error occurred (#"+e.status+")")})}return e(document).ajaxSend(function(e,t,o){o.xhrFields={withCredentials:!0},o.url=-1===o.url.indexOf("?")?o.url+"?ajax=1":o.url.replace("?","?ajax=1&");var n=o.error;if(o.error="function"!=typeof n?r:function(){!1!==n.apply(this,arguments)&&r.apply(this,arguments)},"POST"===o.type&&csrfToken){var a=typeof o.data;null===o.data||"undefined"===a||""===o.data?(o.data="_token="+csrfToken,t.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")):"string"===a?o.data+=(o.data.length?"&":"")+"_token="+csrfToken:o.data instanceof FormData?o.data.append("_token",csrfToken):"object"===a&&(o.data._token=csrfToken)}}),e});
define('sb/ooze',[],function(){function e(n,r,t,s){if(!t)return[];var i,o,l,f,a,u,c,g=[],h=r.length,p=r[s],y=r[s+1];if(s===h&&t._listeners){if("function"==typeof t._listeners)return n&&n.push(t._listeners),[t];for(i=0,o=t._listeners.length;o>i;i++)n&&n.push(t._listeners[i]);return[t]}if("*"===p||"**"===p||t[p]){if("*"===p){for(l in t)"_listeners"!==l&&t.hasOwnProperty(l)&&(g=g.concat(e(n,r,t[l],s+1)));return g}if("**"===p){c=s+1===h||s+2===h&&"*"===y,c&&t._listeners&&(g=g.concat(e(n,r,t,h)));for(l in t)"_listeners"!==l&&t.hasOwnProperty(l)&&("*"===l||"**"===l?(t[l]._listeners&&!c&&(g=g.concat(e(n,r,t[l],h))),g=g.concat(e(n,r,t[l],s))):g=l===y?g.concat(e(n,r,t[l],s+2)):g.concat(e(n,r,t[l],s)));return g}g=g.concat(e(n,r,t[p],s+1))}if(f=t["*"],f&&e(n,r,f,s+1),a=t["**"])if(h>s){a._listeners&&e(n,r,a,h);for(l in a)"_listeners"!==l&&a.hasOwnProperty(l)&&(l===y?e(n,r,a[l],s+2):l===p?e(n,r,a[l],s+1):(u={},u[l]=a[l],e(n,r,{"**":u},s+1)))}else a._listeners?e(n,r,a,h):a["*"]&&a["*"]._listeners&&e(n,r,a["*"],h);return g}function n(e,n){e="string"==typeof e?e.split(a):e.slice();for(var r=0,t=e.length;t>r+1;r++)if("**"===e[r]&&"**"===e[r+1])return;for(var s=l,o=e.shift();o;){if(s[o]||(s[o]={}),s=s[o],0===e.length)return s._listeners?"function"==typeof s._listeners?s._listeners=[s._listeners,n]:i(s._listeners)&&(s._listeners.push(n),!s._listeners.warned&&f>0&&s._listeners.length>f&&(s._listeners.warned=!0,console.error("Warning: possible Ooze memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",s._listeners.length),console.trace())):s._listeners=n,!0;o=e.shift()}return!0}var r,t,s={},i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o={},l={},f=10,a=".";return s.setMaxListeners=function(e){f=e},s.once=function(e,n){return s.many(e,1,n)},s.many=function(e,n,r){function t(){0===--n&&s.off(e,t),r.apply(this,arguments)}if("function"!=typeof r)throw new Error("many only accepts instances of Function");return t._origin=r,s.on(e,t)},s.drip=function(){var n=arguments[0];if(r){for(var s=arguments.length,i=new Array(s-1),f=1;s>f;f++)i[f-1]=arguments[f];for(f=0,s=r.length;s>f;f++)t=n,r[f].apply(this,i)}if("error"===n&&!r&&!o.error&&!l.error)throw arguments[1]instanceof Error?arguments[1]:new Error('Uncaught, unspecified "error" event.');var u=[],c="string"==typeof n?n.split(a):n.slice();if(e(u,c,l,0),"function"==typeof u){if(t=n,1===arguments.length)u.call(this);else if(arguments.length>1)switch(arguments.length){case 2:u.call(this,arguments[1]);break;case 3:u.call(this,arguments[1],arguments[2]);break;default:for(var s=arguments.length,i=new Array(s-1),f=1;s>f;f++)i[f-1]=arguments[f];u.apply(this,i)}return!0}if(u){for(var s=arguments.length,i=new Array(s-1),f=1;s>f;f++)i[f-1]=arguments[f];for(var g=u.slice(),f=0,s=g.length;s>f;f++)t=n,g[f].apply(this,i);return g.length>0||!!r}return!!r},s.on=function(e,r){if("function"==typeof e)return s.onAny(e);if("function"!=typeof r)throw new Error("on only accepts instances of Function");return n(e,r),s},s.addListener=s.on,s.onAny=function(e){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return r||(r=[]),r.push(e),s},s.off=function(n,r){if("function"!=typeof r)throw new Error("removeListener only takes instances of Function");for(var t,o="string"==typeof n?n.split(a):n.slice(),f=e(null,o,l,0),u=0;u<f.length;u++){var c=f[u];if(t=c._listeners,i(t)){for(var g=-1,h=0,p=t.length;p>h;h++)if(t[h]===r||t[h].listener&&t[h].listener===r||t[h]._origin&&t[h]._origin===r){g=h;break}if(0>g)continue;return c._listeners.splice(g,1),0===t.length&&delete c._listeners,s}(t===r||t.listener&&t.listener===r||t._origin&&t._origin===r)&&delete c._listeners}return s},s.offAny=function(e){var n,t=0,i=0;if(e&&r&&r.length>0){for(n=r,t=0,i=n.length;i>t;t++)if(e===n[t])return n.splice(t,1),s}else r=[];return s},s.removeListener=s.off,s.removeAllListeners=function(n){if(0===arguments.length)return s;for(var r="string"==typeof n?n.split(a):n.slice(),t=e(null,r,l,0),i=0;i<t.length;i++){var o=t[i];o._listeners=null}return s},s.listeners=function(n){var r=[],t="string"==typeof n?n.split(a):n.slice();return e(r,t,l,0),r},s.listenersAny=function(){return r||[]},s});
/* postmessage.js AMD -- https://github.com/emirotin/postmessage */
~function(e,t,n){if(typeof module!="undefined"&&module.exports)module.exports=n();else if(typeof define=="function"&&define.amd)define('lib/postmessage',n);else{var r=n(),i=t[e];r.noConflict=function(){t[e]=i;return r};t[e]=r}}("pm",this,function(){"use strict";var e={},t=["log","warn","error","debug"],n="error",r,i;if(!("console"in window)){var s=function(){};for(r=0,i=t.length;r<i;r++){e[t[r]]=s}}else{var o=function(e){if(e=="log"){return true}if(n=="debug"){return true}if(e!="error"&&n=="error"){return false}return true};var u=function(e){return function(){if(o(e)){console[e].apply(console,arguments)}}};for(r=0,i=t.length;r<i;r++){e[t[r]]=u(t[r])}}if(typeof JSON!=="object"){throw new Error("This browser does not have a JSON parser. You need to include json2.js")}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e){if(this==null){throw new TypeError}var t=Object(this);var n=t.length>>>0;if(n===0){return-1}var r=0;if(arguments.length>0){r=Number(arguments[1]);if(r!==r){r=0}else{if(r!==0&&r!==Infinity&&r!==-Infinity){r=(r>0||-1)*Math.floor(Math.abs(r))}}}if(r>=n){return-1}var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++){if(i in t&&t[i]===e){return i}}return-1}}var a=function(e){var t;for(var n=1,r=arguments.length;n<r;n++){t=arguments[n];if(t){for(var i in t){e[i]=t[i]}}}return e};var f,l;l=function(e){f.send(e)};l.bind=function(e,t,n,r,i){f.bind(e,t,n,r,i===true)};l.unbind=function(e,t){f.unbind(e,t)};l.origin=null;l.poll=200;l.setDebugLevel=function(e){if(t.indexOf(e)<0){return}n=e};f={send:function(t){var n=a({},f.defaults,t),r=n.target,i={data:n.data,type:n.type};if(!n.target){e.warn("postmessage target window required");return}if(!n.type){e.warn("postmessage type required");return}if(n.success){i.callback=f._callback(n.success)}if(n.error){i.errback=f._callback(n.error)}if("postMessage"in r&&!n.hash){f._bind();r.postMessage(JSON.stringify(i),n.origin||"*")}else{f.hash._bind();f.hash.send(n,i)}},bind:function(e,t,n,r,i){f._replyBind(e,t,n,r,i)},_replyBind:function(e,t,n,r,i){if("postMessage"in window&&!r){f._bind()}else{f.hash._bind()}var s=f.data("listeners.postmessage");if(!s){s={};f.data("listeners.postmessage",s)}var o=s[e];if(!o){o=[];s[e]=o}o.push({fn:t,callback:i,origin:n||l.origin})},unbind:function(e,t){var n=f.data("listeners.postmessage");if(!n){return}if(!e){for(var r in n){delete n[r]}return}if(t){var i=n[e],s=[];if(i){for(var o=0,u=i.length;o<u;o++){var a=i[o];if(a.fn!==t){s.push(a)}}n[e]=s}}else{delete n[e]}},data:function(e,t){if(t===undefined){return f._data[e]}f._data[e]=t;return t},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){var e=[];for(var t=0;t<32;t++){e[t]=f._CHARS[0|Math.random()*32]}return e.join("")},_callback:function(e){var t=f.data("callbacks.postmessage");if(!t){t={};f.data("callbacks.postmessage",t)}var n=f._random();t[n]=e;return n},_bind:function(){if(!f.data("listening.postmessage")){if(window.addEventListener){window.addEventListener("message",f._dispatch,false)}else if(window.attachEvent){window.attachEvent("onmessage",f._dispatch)}f.data("listening.postmessage",1)}},_dispatch:function(t){function l(e){if(r.callback){f.send({target:n,data:e,type:r.callback})}}function h(e){if(r.errback){f.send({target:n,data:e,type:r.errback})}}var n=t.source,r;try{r=JSON.parse(t.data)}catch(i){e.warn("postmessage data invalid json: ",i);return}if(!r.type){e.warn("postmessage message type required");return}var s=f.data("callbacks.postmessage")||{},o=s[r.type],u=f.data("listeners.postmessage")||{},a=u[r.type]||[];if(o){o(r.data)}else{for(var p=0,d=a.length;p<d;p++){var v=a[p];if(v.origin&&(v.origin instanceof Array&&v.origin.indexOf(t.origin)===-1||(typeof v.origin==="string"||v.origin instanceof String)&&v.origin!=="*"&&t.origin!==v.origin)){e.warn("postmessage message origin mismatch",t.origin,v.origin);if(r.errback){var m={message:"postmessage origin mismatch",origin:[t.origin,v.origin]};f.send({target:t.source,data:m,type:r.errback})}continue}try{if(v.callback){v.fn(r.data,l,h,t)}else{l(v.fn(r.data,t))}}catch(g){if(r.errback){h(g)}else{throw g}}}}}};f.hash={send:function(t,n){var r=t.target,i=t.url,s,o=f.hash._url(window.location.href);if(!i){e.warn("postmessage target window url is required");return}i=f.hash._url(i);if(window==r.parent){s="parent"}else{try{for(var u=0,a=parent.frames.length;u<a;u++){var l=parent.frames[u];if(l==window){s=u;break}}}catch(h){s=window.name}}if(s==null){e.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list");return}var p={"x-requested-with":"postmessage",source:{name:s,url:o},postmessage:n};var d="#x-postmessage-id="+f._random();r.location=i+d+encodeURIComponent(JSON.stringify(p))},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:"#x-postmessage-id=".length+32,_bind:function(){if(!f.data("polling.postmessage")){setInterval(function(){var e=""+window.location.hash,t=f.hash._regex.exec(e);if(t){var n=t[1];if(f.hash._last!==n){f.hash._last=n;f.hash._dispatch(e.substring(f.hash._regex_len))}}},l.poll||200);f.data("polling.postmessage",1)}},_dispatch:function(t){function u(e){if(i.callback){f.send({target:r,data:e,type:i.callback,hash:true,url:t.source.url})}}function a(e){if(i.errback){f.send({target:r,data:e,type:i.errback,hash:true,url:t.source.url})}}if(!t){return}try{t=JSON.parse(decodeURIComponent(t));if(!(t["x-requested-with"]==="postmessage"&&t.source&&t.source.name!=null&&t.source.url&&t.postmessage)){return}}catch(n){return}var r,i=t.postmessage,s=f.data("callbacks.postmessage")||{},o=s[i.type];if(o){o(i.data)}else{if(t.source.name==="parent"){r=window.parent}else{r=window.frames[t.source.name]}var l=f.data("listeners.postmessage")||{};var h=l[i.type]||[];for(var p=0,d=h.length;p<d;p++){var v=h[p];if(v.origin){var m=/https?\:\/\/[^\/]*/.exec(t.source.url)[0];if(v.origin instanceof Array&&v.origin.indexOf(m)===-1||(typeof v.origin==="string"||v.origin instanceof String)&&v.origin!=="*"&&m!==v.origin){e.warn("postmessage message origin mismatch",m,v.origin);if(i.errback){var g={message:"postmessage origin mismatch",origin:[m,v.origin]};f.send({target:r,data:g,type:i.errback,hash:true,url:t.source.url})}continue}}try{if(v.callback){v.fn(i.data,u,a)}else{u(v.fn(i.data))}}catch(y){if(i.errback){a(y)}else{throw y}}}}},_url:function(e){return(""+e).replace(/#.*$/,"")}};a(f,{defaults:{target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:false}});return l})
;
define('sb/requiresAuthentication',["$","sb/ooze","lib/postmessage"],function(n,t,e){"use strict";return function(o,i,s){return"undefined"==typeof s&&"function"==typeof i&&(s=i,i="sbSignup"),0===n("[data-logged-out]").length?s:function(){function n(){o&&t.once(["modals","close",o],function(){e({target:window.parent,type:"sbReload",data:{}})})}var a=arguments;t.removeAllListeners("sb.signup").on("sb.signup",function(){n(),e({target:window.parent,type:"sbSignup",data:{}}),s.apply(this,a)}).removeAllListeners("sb.login").on("sb.login",function(){n(),e({target:window.parent,type:"sbLogin",data:{}}),s.apply(this,a)}),e({target:window,type:i,data:{}})}}});
define('sb/loadingButton',["$"],function(t){"use strict";var n=function(n){var i=t(n.el),e=t("<span>").addClass(n.className||"icon-spinner icon-t-animation-spin"),r=i.html();return{updateText:function(t){return i.text(t),this},disable:function(){return i.attr("disabled",!0),this},enable:function(){return i.attr("disabled",!1),this},show:function(){return i.show(),this},hide:function(){return i.hide(),this},start:function(){return i.css("width",i.outerWidth()).attr("disabled",!0).html(e),this},stop:function(){return i.attr("disabled",!1).html(r).css("width",""),this},get:function(){return i}}};return n});
define('routes/sbnav',["jquery"],function(e){"use strict";var t,a=location.hostname,s=a.match(/([^-]+)(.+)?(-staging.+)/),c="sbnav.",n={like:{path:"/i/like/{slug}/{id}",scheme:"https:",defaults:{}},unlike:{path:"/i/unlike/{slug}/{id}",scheme:"https:",defaults:{}},send_verification_email:{path:"/i/verification/{accountId}/send",scheme:"https:",defaults:{}},event_rsvp:{path:"/i/rsvp",scheme:"https:",defaults:{}},contest_participation:{path:"/i/contests/{accountId}/participation",scheme:"https:",defaults:{}},poll_entry:{path:"/i/polls/{accountId}/entry",scheme:"https:",defaults:{}},error_log:{path:"/i/el",scheme:"https:",defaults:{}},comments_load:{path:"/i/{accountId}/comments/load",scheme:"https:",defaults:{}},comments_create:{path:"/i/{accountId}/comments/create",scheme:"https:",defaults:{}},comments_delete:{path:"/i/{accountId}/comments/delete",scheme:"https:",defaults:{}},user_profile_edit:{path:"/i/profile",scheme:"https:",defaults:{}},password_forgot:{path:"/i/password/forgot",scheme:"https:",defaults:{}},password_reset:{path:"/i/password/reset",scheme:"https:",defaults:{}},set_timezone:{path:"/i/timezone",scheme:"https:",defaults:{}},inline_email_list_signup:{path:"/{accountUrl}/email/{emailListId}/signup",scheme:"https:",defaults:{}},inline_redeem_promo_code:{path:"/i/{accountId}/code/{accountCodeId}/redeem",scheme:"https:",defaults:{}},main:{path:"/{accountUrl}/{slug}/{id}",scheme:"https:",defaults:{slug:"",id:""}},fan_club_app_nag:{path:"/i/fanclub/appnag",scheme:"https:",defaults:{}},internal_add_account_link:{path:"/{accountUrl}/link/add",scheme:"https:",defaults:{}},internal_remove_account_link:{path:"/{accountUrl}/link/remove",scheme:"https:",defaults:{}},internal_enable_content_section:{path:"/{accountUrl}/section/enable",scheme:"https:",defaults:{}},internal_disable_content_section:{path:"/{accountUrl}/section/disable",scheme:"https:",defaults:{}},internal_save_account:{path:"/{accountUrl}/save",scheme:"https:",defaults:{}},internal_upload_account_photo:{path:"/{accountUrl}/photo/upload",scheme:"https:",defaults:{}},internal_remove_account_photo:{path:"/{accountUrl}/photo/remove",scheme:"https:",defaults:{}}};return s?("www."===c&&(c=""),c&&(c="-"+c.replace(".","")),t=s[1]+c+s[3]):t=c+function(e){return e.slice(3===e.length|0).join(".")}(a.split(".")),t=t.replace(/^www.stagebloc/,"www.fullscreendirect").replace(/^cart.fullscreendirect/,"cart.stagebloc"),function(a,s){if(!n[a])return console.error('error with route "'+a+'"');var c=n[a].path;return e.each(e.extend({},n[a].defaults,s),function(e,t){var a=c.replace("{"+e+"}",t);a!==c?c=a:c+=(-1===c.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(t)}),n[a].scheme+"//"+t+c}});
(function(e){if(typeof define==="function"&&define.amd)define('lib/jquery-deparam',["jquery"],e);else e(jQuery)})(function(e){e.deparam=function(t,n){var r={},i={"true":!0,"false":!1,"null":null};e.each(t.replace(/\+/g," ").split("&"),function(t,s){var o;var u=s.split("="),a=decodeURIComponent(u[0]),f=r,l=0,c=a.split("]["),p=c.length-1;/\[/.test(c[0])&&/\]$/.test(c[p])?(c[p]=c[p].replace(/\]$/,""),c=c.shift().split("[").concat(c),p=c.length-1):p=0;if(2===u.length)if(u=decodeURIComponent(u[1]),n&&(u=u&&!isNaN(u)?+u:"undefined"===u?void 0:void 0!==i[u]?i[u]:u),p)for(;l<=p;l++)a=""===c[l]?f.length:c[l],o=f[a]=l<p?f[a]||(c[l+1]&&isNaN(c[l+1])?{}:[]):u,f=o;else e.isArray(r[a])?r[a].push(u):r[a]=void 0!==r[a]?[r[a],u]:u;else a&&(r[a]=n?void 0:"")});return r}})
;
define('sbnav',["$","sb/requiresAuthentication","sb/ooze","sb/loadingButton","lib/postmessage","routes/sbnav","lib/jquery-deparam"],function(e,t,n,a,r,o){"use strict";function i(e,t){e.then(function(){t.resolve.apply(this,arguments)},function(){t.reject.apply(this,arguments)})}function s(t,a){return function(r){return r.error||r.errors?(e(t).find(".js-form-error").html(r.error||r.errors[0]).parent().removeClass("notice-s-hidden"),e(t).find("input").first().focus(),a&&a.stop(),void 0):(window.csrfToken=r.csrfToken||window.csrfToken,e(t).parents('[data-modal-name="login"]').length&&n.listeners("sb.login").length?n.drip("sb.login"):e(t).parents('[data-modal-name="signup"]').length&&n.listeners("sb.signup").length?n.drip("sb.signup"):r.url&&r.action&&"redirect"===r.action?d({target:window.top,type:"sbReload",data:{url:r.url}}):d({target:window.top,type:"sbReload",data:{}}),void 0)}}var u=e.Deferred(),d=e.extend(function(){var e=arguments;u.then(function(){r.apply(window,e)})},r);d.bind("sbReady",function(){u.resolve(),d({target:window.parent,type:"sbReady",data:{}})}),d.answer=function(t,n){function a(e){d({target:window.parent,type:t,data:e})}d.bind(t,function(t){var r=t.__uid?{__uid:t.__uid}:{};n.call(this,t.__payload?t.__payload:t).done(function(t){a(e.extend({},t,r))}).fail(function(t){t&&"function"!=typeof t.then||(t={});var n=e.extend({},t,r);n.error=n.error||!0,a(n)})})},window.top===window&&u.resolve(),window.pm=r,jQuery(document).ajaxSend(function(e,t,n){if(-1===n.url.indexOf("sessionId=")){var a="sessionId="+sessionId;n.url=-1===n.url.indexOf("?")?n.url+"?"+a:n.url.replace("?","?"+a+"&")}});var c=function(){d({target:window.parent,type:"sbnavModal",data:{}}),e("html").removeClass("is-opened")};e(window).on("load.sbnav",function(){e("[data-important-prompt]").length?require(["sb/modals","legacy"],function(e){setTimeout(function(){e.open("important-prompt"),c()},15)}):e("[data-verification-prompt]").length?require(["sb/modals","routes/web","legacy"],function(t,n){setTimeout(function(){e(".modal-overlay, .cart-frame-s-open").length||(t.open("user-verification-prompt",n("user_verification_prompt",{account:e("[data-account-url]").attr("data-account-url")})),c())},15)}):e("[data-information-prompt]").length?require(["sb/modals","routes/web","legacy"],function(t,n){setTimeout(function(){e(".modal-overlay, .cart-frame-s-open").length||(t.open("user-info-prompt",n("user_information_prompt")),c())},15)}):e("[data-credit-card-prompt]").length&&require(["sb/modals","routes/web","legacy"],function(t,n){setTimeout(function(){e(".modal-overlay, .cart-frame-s-open").length||(t.open("credit-card-prompt",n("fan_club_membership_payment_method",{account:e("[data-account-url]").attr("data-account-url"),prompt:!0})),c())},15)}),e("[data-error-string]").length&&require(["sb/notice","legacy"],function(t){var n=t.error;e.when(u,legacy).then(function(){n(e("[data-error-string]").attr("data-error-string"))})}),require(["lib/jquery-tipsy"],function(){e(".js-tipsy").tipsy({gravity:"s",live:!0})}),e("#sbnavcss").attr("href",function(){return e(this).attr("data-href")}),require(["legacy"])}),window.sbWindowHasLoaded&&e(window).trigger("load.sbnav");var l=function(t){e(".modal-overlay, .cart-frame-s-open, .alert-bar").length||"pending"===u.state()||(e("html").removeClass("is-opened"),d({target:window.parent,type:"sbnavSize",data:{immediate:!0===t,height:0,width:0}}))};e(function(){e("html").on("click touchstart touchmove",function(e){e.stopPropagation()}),e("body").on("change",'[data-modal-name="signup"] select',function(){e('[data-modal-name="signup"]').attr("data-birthday-changed",!0)}).on("focusout",'[data-modal-name="signup"] .js-signup-email',function(){var t=e('[data-modal-name="signup"] .js-signup-username');""===t.val()&&t.val(e(this).val().substring(0,e(this).val().indexOf("@")).replace(/[^a-zA-Z0-9\_]/gi,""))}).on("click",".js-facebook-login",function(t){var n,a=this;return t.stopPropagation(),t.preventDefault(),window.open(e(this).attr("href"),"Login to Facebook","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600"),d.bind("fbLogin",n=function(t){d.unbind("fbLogin",n),s(e(a).closest(".js-modal-form"))(t)}),!1}).on("submit",".js-modal-form",function(t){var n=this,r=new a({el:e(".js-submit",this)}).start();return e(this).find(".js-form-error").parent().addClass("notice-s-hidden"),e('.modal-s-open[data-modal-name="signup"]').not("[data-birthday-changed]").length&&!confirm("Are you sure this is your actual birthday?")?(r.stop(),!1):e(this).hasClass("js-modal-form-noajax")?!0:(t.preventDefault(),e.ajax({type:"POST",url:e(this).attr("action"),data:e(this).serialize(),success:s(n,r)}),!1)}),e("[data-cart-autoopen]").length&&d({target:window,type:"sbCart",data:{}}),e("[data-join-fanclub-tier]").length&&d({target:window,type:"sbJoinFanClub",data:{tier:e("[data-join-fanclub-tier]").attr("data-join-fanclub-tier"),view:"signup",reload:!0}}),e("[data-need-timezone]").length&&require(["lib/jstz"],function(t){e.ajax({type:"POST",data:{zone:t.determine_timezone().name()},url:o("set_timezone")})})}),n.on("modals.close.*",function(){return e(".alert-bar").length?n.drip("notice.show"):(l(!0),void 0)}).on("sb.submittedContent",function(){d({target:window.parent,type:"sbSubmittedContent",data:{}}),e("body").removeAttr("data-open-content-modal")}).on("sb.joinedContest",function(){d({target:window.parent,type:"sbJoinedContest",data:{}})}).on("notice.show",function(){e(".modal-overlay, .cart-frame-s-open").length||"pending"===u.state()||d({target:window.parent,type:"sbnavNotice",data:{}})}).on("notice.dismiss",function(){l(!0)}),d.bind("sbAccountProfileModal",function(e){require(["sb/modals","routes/web","legacy"],function(t,n){t.open("account",n("account_modal",e)),c()})}),d.bind("sbEditUserProfileModal",function(){require(["sb/modals","routes/web","legacy"],function(e,t){e.open("user-profile",t("user_profile",{})),c()})}),d.bind("sbEditUserSettingsModal",function(){require(["sb/modals","routes/web","legacy"],function(e,t){e.open("user-settings",t("user_settings",{})),c()})}),d.bind("sbEditUserNotificationSettingsModal",function(e){require(["sb/modals","routes/web","legacy"],function(t,n){t.open("user-notifications",n("user_notification_settings",e)),c()})}),d.bind("sbEditContestEntryModal",t("user-contest-entry",function(e){require(["sb/modals","routes/web","legacy"],function(t,n){t.open("user-contest-entry",n("user_modal_contest",e),void 0,void 0,void 0,"replace"),c()})})),d.bind("sbEmailListSignupModal",function(e){require(["sb/modals","routes/web","legacy"],function(t,n){t.open("email-list-signup",n("email_list_signup_modal",e)),c()})}),d.bind("sbMobilePhoneNumber",function(e){require(["sb/modals","routes/web","legacy"],function(t,n){t.open("user-phone",n("user_mobile_phone",e)),c()})}),d.bind("sbCrowdSurgeTicketModal",function(e){d({target:window,type:"sbSongkickTicketModal",data:e})}),d.bind("sbSongkickTicketModal",function(e){require(["sb/modals","routes/web","legacy"],function(t,n){t.open("songkick-ticket-history",n("user_modal_songkick",e)),c()})}),d.bind("sbCart",function(t){"string"==typeof t&&(t=e.deparam(t)),c(),require(["sb/cart","legacy"],function(e){t.type&&t.id?(n.on("cart.loading",function(){c()}),e.add(t,function(e){c(),d({target:window.parent,type:"sbCartCountUpdate",data:{count:e.count}})})):(c(),e.open())})}),d.bind("sbFreeDownload",function(e){require(["sb/cart","legacy"],function(t){t.free(e)})}),n.on("cart.updateCount",function(e){d({target:window.parent,type:"sbCartCountUpdate",data:{count:e.itemCount}})}).on("cart.close",function(e){l(!0),d({target:window.parent,type:"sbCartCountUpdate",data:{count:e.itemCount}})}).on("modals.open.free-download",function(){c()}).on("modals.open.*",function(t){e(".js-sbnav-disable-notifications-tray").removeAttr("data-modal-close data-tray data-tray-href"),d({target:window.parent,type:"sbModalOpen",data:{modal:e(t).attr("data-modal-name")}})}),d.bind("cart.success",function(e){d({target:window.parent,type:"sbCartSuccess",data:e})}),d.bind("sbShareContent",function(e){require(["sb/modals","routes/web","legacy"],function(t,n){t.open("share",n("user_modal_share_show",e)),c()})}),d.bind("sbSubmitContent",function(t){t=t||{},!1===t.openContentModal&&e("body").attr("data-open-content-modal","false"),require(["sb/modals","routes/web","legacy"],function(n,a){n.open("fan-club-submit",a("fan_club_submit_modal",{account:e("[data-account-url]").attr("data-account-url"),category:t?t.category||"":"",submitMode:t?t.content_type||"":""})),c()})}),d.bind("sbReportContent",function(e){require(["sb/modals","routes/web","legacy"],function(t,n){t.open("flag",n("flag_modal",{slug:e.content_slug,id:e.content_id})),c()})}),d.bind("sbComment",function(e){var t=e.content_slug||getParams.content_slug,n=e.content_id||getParams.content_id;require(["sb/modals","routes/web","legacy"],function(e,a){e.open("content",a("content_modal",{slug:t,id:n})),c()})}),d.answer("sbCommentUpload",function(t){var n=e.Deferred(),a=t.base64File,r=t.content_slug,o=t.content_id,i=t.filename;return require(["routes/web","lib/data-uri-to-blob"],function(t,s){var u=s(a);e.ajax({type:"POST",url:t("content_comment_upload_policy",{id:o,slug:r},!0),data:{filename:i}}).success(function(t){var a=new FormData;for(var r in t.inputs)a.append(r,t.inputs[r]);a.append("file",u),e.ajax({global:!1,processData:!1,type:t.form.method,url:t.form.action,contentType:!1,data:a}).success(function(){n.resolve({url:t.url})}).error(function(){n.reject({error:"Upload failed; please try again"})})}).error(function(e){n.reject({error:e&&e.responseJSON&&e.responseJSON.error||"Upload failed; please try again."})})}),n.promise()}),d.bind("sbFollow",function(){e("[data-logged-out]").length?d({target:window,type:"sbLogin",data:{}}):require(["routes/web"],function(t){e.ajax({type:"POST",data:{id:e("[data-account-id]").attr("data-account-id"),join:!0},url:t("explore_who_to_follow_join"),success:function(e){e.modalHref?require(["sb/modals","legacy"],function(t){t.open("fan-club-join",e.modalHref),c()}):e.error?require(["sb/notice"],function(t){var n=t.error;n(e.error)}):(require(["sb/notice"],function(t){var n=t.notice;n(e.success)}),d({target:window.parent,type:"sbReload",data:{}}))}})})}),d.bind("sbPurchaseMembership",t(void 0,function(e){d({target:window,type:"sbCart",data:e})})),d.bind("sbFanClubMembershipManagement",function(){require(["sb/modals","routes/web","legacy"],function(t,n){t.open("fan-club-membership",n("fan_club_membership_modal",{account:e("[data-account-url]").attr("data-account-url")})),c()})}),d.bind("sbJoinFansite",function(e){d({target:window,type:"sbJoinFanClub",data:e})}),d.bind("sbJoinFanClub",function(t){t=t||{},require(["sb/modals","routes/web","legacy"],function(a,r){var o=function(t){var n="boolean"==typeof t.forceFreeTier?1:t.forceFreeTier;e.ajax({type:"POST",data:{forceFree:!0,tier:n},url:r("fan_club_join_modal",{account:e("[data-account-url]").attr("data-account-url")}),statusCode:{401:function(){alert("There was an error processing your request. Please try again.")}},success:function(e){e?e.error?alert(e.error):(d({target:window.parent,type:"sbJoinFanClub",data:{tier:n}}),setTimeout(function(){d({target:window.parent,type:"sbReload",data:t.redirectUrl?{url:e.redirectUrl}:{}})},300)):d({target:window.parent,type:"sbReload",data:{}})}})};!function(t,a){return 0===e("[data-logged-out]").length?(a(),void 0):(t.forceFreeTier&&(a=function(e){return function(){o(e)}}(t)),n.removeAllListeners("sb.signup").on("sb.signup",function(){d({target:window.parent,type:"sbSignup",data:{}}),a()}).removeAllListeners("sb.login").on("sb.login",function(){d({target:window.parent,type:"sbLogin",data:{}}),a()}).once("modals.close.fan-club-join",function(){e(".cart-frame-s-open").length?(d.bind("cart.success",function(e){var t;e.google_analytics.items.forEach(function(e){var n=e.name.match(/Tier (\d) Fan Club Membership/);n&&n[1]&&(t=n[1])}),t?(d({target:window.parent,type:"sbJoinFanClub",data:{tier:t}}),setTimeout(function(){d({target:window.parent,type:"sbReload",data:{}})},300)):d({target:window.parent,type:"sbReload",data:{}})}),n.once("cart.close",function(){d({target:window.parent,type:"sbReload",data:{}})})):d({target:window.parent,type:"sbReload",data:{}})}),"signup"===t.view?d({target:window,type:"sbSignup",data:{}}):d({target:window,type:"sbLogin",data:{}}),void 0)}(t,function(){c(),"string"==typeof t&&(t=e.deparam(t));var n=r("fan_club_join_modal",e.extend({},t,{account:e("[data-account-url]").attr("data-account-url")}));return t.forceFreeTier?o(t):(a.open("fan-club-join",n,void 0,void 0,void 0,"false"),void 0)})})}),d.bind("sbSignup",function(){require(["sb/modals","legacy"],function(e){e.open("signup"),c()})}),d.bind("sbLogin",function(){require(["sb/modals","legacy"],function(e){e.open("login"),c()})}),d.bind("sbForgotPassword",function(){require(["sb/modals","legacy"],function(e){e.open("forgot-password"),c()})}),d.answer("sbLike",function(t){return e("[data-logged-out]").length?(require(["sb/notice"],function(e){var t=e.notice;t("Please login to like this content")}),e.Deferred().reject({error:"Please login to like this content"}).promise()):e.ajax({type:"POST",url:o("unlike"===t.action?"unlike":"like",{slug:t.content_slug,id:t.content_id,commentId:t.comment_id})}).promise()}),d.answer("sbInlineEmailListSignup",function(t){if("string"==typeof t&&(t=e.deparam(t)),!t.emailListId)return e.Deferred().reject({error:"You must include an email list ID for this signup"});var n={accountUrl:e("[data-account-url]").attr("data-account-url"),emailListId:t.emailListId};return e.ajax({type:"POST",data:t,url:o("inline_email_list_signup",n)}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineEmailListSignup",message:"User not authorized."}})}}).promise()});var p=function(){return Math.floor((new Date-b)/(1e3*(e("[data-user-is-admin]").length?1:30)))>=1},b=0;d.answer("sbInlineSubmitStatus",function(t){if(!p())return d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitStatus",message:"Please wait before submitting another status."}}),e.Deferred().reject().promise();var n=e.Deferred();return require(["routes/web"],function(a){var r=e.ajax({type:"POST",data:t,url:a("fan_club_submit_modal_save",{account:e("[data-account-url]").attr("data-account-url"),submitMode:"statuses",api:"api"})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitStatus",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitStatus",message:"Unknown error."}})}).done(function(){b=new Date}).promise();i(r,n)}),n.promise()}),d.answer("sbInlineSubmitAudio",function(t){if(!p())return d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitAudio",message:"Please wait before submitting more audio."}}),e.Deferred().reject().promise();var n=e.Deferred();return require(["routes/web"],function(a){var r=e.ajax({type:"POST",data:t,url:a("fan_club_submit_modal_save",{account:e("[data-account-url]").attr("data-account-url"),submitMode:"audio",api:"api"})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitAudio",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitAudio",message:"Unknown error."}})}).done(function(){b=new Date}).promise();i(r,n)}),n.promise()}),d.answer("sbInlineSubmitVideo",function(t){if(!p())return d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitVideo",message:"Please wait before submitting another video."}}),e.Deferred().reject().promise();var n=e.Deferred();return require(["routes/web"],function(a){var r=e.ajax({type:"POST",data:t,url:a("fan_club_submit_modal_save",{account:e("[data-account-url]").attr("data-account-url"),submitMode:"videos",api:"api"})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitVideo",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitVideo",message:"Unknown error."}})}).done(function(){b=new Date}).promise();i(r,n)}),n.promise()}),d.answer("sbInlineSubmitBlog",function(t){if(!p())return d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitBlog",message:"Please wait before submitting another post."}}),e.Deferred().reject().promise();var n=e.Deferred();return require(["routes/web"],function(a){var r=e.ajax({type:"POST",data:t,url:a("fan_club_submit_modal_save",{account:e("[data-account-url]").attr("data-account-url"),submitMode:"blog",api:"api"})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitBlog",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitBlog",message:"Unknown error."}})}).done(function(){b=new Date}).promise();i(r,n)}),n.promise()}),d.answer("sbInlineSubmitPhoto",function(t){if(!p())return d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitPhoto",message:"Please wait before submitting another photo."}}),e.Deferred().reject().promise();var n=e.Deferred();return require(["routes/web"],function(a){var r=e.ajax({type:"POST",data:t,url:a("fan_club_submit_modal_save",{account:e("[data-account-url]").attr("data-account-url"),submitMode:"photos",api:"api"})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitPhoto",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSubmitPhoto",message:"Unknown error."}})}).done(function(){b=new Date}).promise();i(r,n)}),n.promise()}),d.answer("sbInlineReportContent",function(t){"string"==typeof t&&(t=e.deparam(t));var n=e.Deferred();return require(["routes/web"],function(a){var r=e.ajax({type:"POST",data:{type:t.report_type,reason:t.report_reason},url:a("flag_modal_submit",{slug:t.report_slug,id:t.report_id})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineReportContent",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineReportContent",message:"Unknown error."}})}).always(function(){return{data:t.error||t.success||"An error occurred flagging this content!"}}).promise();i(r,n)}),n.promise()}),d.answer("sbDelete",function(t){return confirm("Deleting this content is permanent; are you sure?")?("string"==typeof t&&(t=e.deparam(t)),require(["routes/web","sb/notice","legacy"],function(n,a){var r=a.notice;e.ajax({type:"POST",url:n("content_delete",{id:t.contentId,slug:t.contentSlug},!0),success:function(){r("Content deleted!")}})}),void 0):!1}),d.answer("sbInlineLoadComments",function(t){return e.ajax({type:"POST",data:t,url:o("comments_load",{accountId:e("[data-account-id]").attr("data-account-id")})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineLoadComments",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineLoadComments",message:"Unknown error."}})}).promise()}),d.answer("sbInlineComment",function(t){if(!p())return d({target:window.parent,type:"sbError",data:{type:"sbInlineComment",message:"Please wait before submitting another comment."}}),e.Deferred().reject().promise();var n=e.ajax({type:"POST",data:t,url:o("comments_create",{accountId:e("[data-account-id]").attr("data-account-id")})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineComment",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineComment",message:"Unknown error."}})});return n.done(function(){b=new Date}),n.promise()}),d.answer("sbInlineDeleteComment",function(t){return e.ajax({type:"POST",data:t,url:o("comments_delete",{accountId:e("[data-account-id]").attr("data-account-id")})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineDeleteComment",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineDeleteComment",message:"Unknown error."}})}).promise()}),d.answer("sbInlineRedeemPromoCode",function(t){return e.ajax({type:"POST",data:{code:t.code},url:o("inline_redeem_promo_code",{accountId:e("[data-account-id]").attr("data-account-id"),accountCodeId:t.accountCodeId})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineRedeemPromoCode",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineRedeemPromoCode",message:"Unknown error."}})}).promise()}),d.answer("sbInlineUserPasswordReset",function(t){return e.ajax({type:"POST",data:t,url:o("password_reset")}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineUserPasswordReset",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineUserPasswordReset",message:"Unknown error."}})}).promise()}),d.answer("sbInlineUserForgotPassword",function(t){return e.ajax({type:"POST",data:t,url:o("password_forgot",{accountId:e("[data-account-id]").attr("data-account-id")})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineUserForgotPassword",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineUserForgotPassword",message:"Unknown error."}})}).promise()}),d.answer("sbInlineSendVerificationEmail",function(t){return e.ajax({type:"POST",data:t,url:o("send_verification_email",{accountId:e("[data-account-id]").attr("data-account-id")})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSendVerificationEmail",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSendVerificationEmail",message:"Unknown error."}})}).promise()}),d.answer("sbInlineEventRSVP",function(t){return e.ajax({type:"POST",data:t,url:o("event_rsvp")}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineEventRSVP",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineEventRSVP",message:"Unknown error."}})}).promise()}),d.answer("sbInlineLogin",function(t){var n=e.Deferred();return require(["routes/web"],function(a){var r=e.ajax({type:"POST",data:t,url:a("login")}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineLogin",message:"Unknown error."}})}).done(function(e){window.csrfToken=e.csrfToken||window.csrfToken,e.success&&setTimeout(function(){window.location.reload()},150)}).promise();i(r,n)}),n.promise()}),d.answer("sbInlineFollow",function(t){var n=e.Deferred();return require(["routes/web"],function(a){var r=e.ajax({type:"POST",data:t,url:a("fan_club_join_modal",{account:accountUrl}),statusCode:{401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineFollow",message:"User not authorized."}})}},error:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineFollow",message:"Unknown error."}})},success:function(e,t,a){var r=a.getResponseHeader("content-type")||"";r.indexOf("html")>-1?(d({target:window,type:"sbJoinFansite",data:e}),n.resolve()):r.indexOf("json")>-1&&setTimeout(function(){window.location.reload()},150)}}).promise();i(r,n)}),n.promise()}),d.answer("sbInlineSignup",function(t){var n=e.Deferred();return require(["routes/web"],function(a){var r=e.ajax({type:"POST",data:t,url:a("signup")}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSignup",message:"User not authorized."}})}}).error(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineSignup",message:"Unknown error."}})}).done(function(e){window.csrfToken=e.csrfToken||window.csrfToken,e.success&&setTimeout(function(){window.location.reload()},150)}).promise();i(r,n)}),n.promise()}),d.answer("sbInlineUserProfileEdit",function(t){return e.ajax({type:"POST",data:t,url:o("user_profile_edit")}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineUserProfileEdit",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineUserProfileEdit",message:"Unknown error."}})}).promise()}),d.answer("sbInlineEditContestParticipation",function(t){return e.ajax({type:"POST",data:t,url:o("contest_participation",{accountId:e("[data-account-id]").attr("data-account-id")})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineEditContestParticipation",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"sbInlineEditContestParticipation",message:"Unknown error."}})}).promise()}),d.answer("ecHMOTdata",function(t){return e.ajax({type:"POST",data:t,url:o("poll_entry",{accountId:e("[data-account-id]").attr("data-account-id")})}).statusCode({401:function(){d({target:window.parent,type:"sbError",data:{type:"ecHMOTdata",message:"User not authorized."}})}}).fail(function(){d({target:window.parent,type:"sbError",data:{type:"ecHMOTdata",message:"Unknown error."}})}).promise()})});
